<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Простой чат</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f3f3f3;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
  height: 100vh;
}
#login, #chat {
  width: 100%;
  max-width: 400px;
  background: white;
  margin-top: 50px;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
}
#chat {
  display: none;
}
input[type="text"], input[type="password"] {
  width: 100%;
  padding: 8px;
  margin: 6px 0;
  box-sizing: border-box;
}
button {
  width: 100%;
  padding: 10px;
  background: #0078d7;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
button:hover {
  background: #005fa3;
}
#messages {
  height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  margin-bottom: 10px;
}
.msg {
  margin-bottom: 8px;
}
.name {
  font-weight: bold;
}
</style>
</head>
<body>

<div id="login">
  <h2>Регистрация / Вход</h2>
  <input type="text" id="username" placeholder="Имя" />
  <input type="password" id="password" placeholder="Пароль" />
  <button id="registerBtn">Регистрация</button>
  <button id="loginBtn">Вход</button>
</div>

<div id="chat">
  <h2>Чат</h2>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Введите сообщение..." />
  <button id="sendBtn">Отправить</button>
</div>

<script>
const users = JSON.parse(localStorage.getItem('users') || '{}');
const messages = JSON.parse(localStorage.getItem('messages') || '[]');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const registerBtn = document.getElementById('registerBtn');
const loginBtn = document.getElementById('loginBtn');
const loginDiv = document.getElementById('login');
const chatDiv = document.getElementById('chat');
const messagesDiv = document.getElementById('messages');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');

let currentUser = null;

// Отрисовка сообщений
function renderMessages() {
  messagesDiv.innerHTML = messages.map(m => 
    `<div class="msg"><span class="name">${m.name}:</span> ${m.text}</div>`
  ).join('');
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// Регистрация
registerBtn.onclick = () => {
  const name = usernameInput.value.trim();
  const pass = passwordInput.value.trim();
  if (!name || !pass) return alert('Введите имя и пароль!');
  if (users[name]) return alert('Пользователь уже существует!');
  users[name] = pass;
  localStorage.setItem('users', JSON.stringify(users));
  alert('Регистрация успешна! Теперь войдите.');
};

// Вход
loginBtn.onclick = () => {
  const name = usernameInput.value.trim();
  const pass = passwordInput.value.trim();
  if (!name || !pass) return alert('Введите имя и пароль!');
  if (!users[name] || users[name] !== pass) return alert('Неверные имя или пароль!');
  currentUser = name;
  loginDiv.style.display = 'none';
  chatDiv.style.display = 'block';
  renderMessages();
};

// Отправка сообщения
sendBtn.onclick = () => {
  const text = messageInput.value.trim();
  if (!text) return;
  messages.push({ name: currentUser, text });
  localStorage.setItem('messages', JSON.stringify(messages));
  messageInput.value = '';
  renderMessages();
};

// Позволяет отправлять Enter
messageInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendBtn.click();
});
</script>

</body>
</html>
